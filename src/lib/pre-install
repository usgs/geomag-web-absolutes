#! /usr/bin/env php
<?php

$LIB_DIR = dirname(__FILE__);
$APP_DIR = dirname($LIB_DIR);
$CONFIG_FILE = '../conf/config.ini';
$APACHE_CONFIG_FILE = '../conf/httpd.conf';

// work from lib directory
chdir($LIB_DIR);
// set default timezone
date_default_timezone_set('UTC');


// setup configuration defaults and help

$DEFAULTS = array(
	'APP_DIR' => $APP_DIR,
	'DATA_DIR' => str_replace('/apps/', '/data/', $APP_DIR),
	'MOUNT_PATH' => '/webabsolutes',
	'SQLITE_DB' => 'testdata.db'
);

$HELP_TEXT = array(
	'APP_DIR' => 'Absolute path to application root directory',
	'DATA_DIR' => 'Absolute path to application data directory',
	'MOUNT_PATH' => 'Url path to application',
	'SQLITE_DB' => 'Name of Sqlite Database file (within data directory)'
);


// interactively configure

include 'configure.php';



// output apache configuration

file_put_contents($APACHE_CONFIG_FILE, '
	# auto generated by ' . __FILE__ . ' at ' . date('r') . '
	Alias ' . $CONFIG['MOUNT_PATH'] . ' ' . $CONFIG['APP_DIR'] . '
	<Location ' . $CONFIG['MOUNT_PATH'] . '>
		Order Allow,Deny
		Allow from all
	</Location>
');


// setup database

$dbpath = $CONFIG['DATA_DIR'] . DIRECTORY_SEPARATOR . $CONFIG['SQLITE_DB'];
if (!file_exists($dbpath)) {
	$dbtemplate = implode(DIRECTORY_SEPARATOR,
			array($LIB_DIR, "sql", "sqlite", "testdata.db"));

	echo 'Creating sqlite database in ' . $dbpath . "\n";
	copy($dbtemplate, $dbpath);
}
